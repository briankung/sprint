<div class="problem-number">Problem 366</div>
<div class="problem-name">Stone Game III</div>
<div class="problem-content">
<p>
Two players, Anton and Bernhard, are playing the following game.<br>
There is one pile of n stones.<br>
The first player may remove any positive number of stones, but not the whole pile.<br>
Thereafter, each player may remove at most twice the number of stones his opponent took on the previous move.<br>
The player who removes the last stone wins.
</p>
<p>
E.g. n=5<br>
If the first player takes anything more than one stone the next player will be able to take all remaining stones.<br>
If the first player takes one stone, leaving four, his opponent will take also one stone, leaving three stones.<br>
The first player cannot take all three because he may take at most 2x1=2
 stones. So let's say he takes also one stone, leaving 2. The second 
player can take the two remaining stones and wins.<br>
So 5 is a losing position for the first player.<br>
For some winning positions there is more than one possible move for the first player.<br>
E.g. when n=17 the first player can remove one or four stones.
</p>
<p>
Let M(n) be the maximum number of stones the first player can take from a winning position <i>at his first turn</i> and M(n)=0 for any other position.
</p>
<p>
<img src="/files/symbol_sum.gif" alt="∑" style="vertical-align:middle;" border="0" height="14" width="11">M(n) for n<img src="/files/symbol_le.gif" alt="≤" style="vertical-align:middle;" border="0" height="12" width="10">100 is 728.
</p>
<p>
Find  <img src="/files/symbol_sum.gif" alt="∑" style="vertical-align:middle;" border="0" height="14" width="11">M(n) for n<img src="/files/symbol_le.gif" alt="≤" style="vertical-align:middle;" border="0" height="12" width="10">10<sup>18</sup>.
Give your answer modulo 10<sup>8</sup>.
</p>
</div>
